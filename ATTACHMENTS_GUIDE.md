# دليل عرض المرفقات والصور

## الوصف
تم إضافة ميزة عرض المرفقات والصور المرفوعة في صفحة تفاصيل اليتيم.

## المميزات الجديدة

### 1. عرض المرفقات في تفاصيل اليتيم
- عند فتح تفاصيل يتيم من صفحة الأيتام، سيظهر قسم جديد يعرض جميع المرفقات المرتبطة بهذا اليتيم
- يتم عرض الصور بشكل مصغر في شبكة (Grid)
- للملفات غير الصور (PDF مثلاً)، يظهر أيقونة ملف مع رابط لفتحه

### 2. معاينة الصور بحجم كامل
- عند الضغط على أي صورة، تفتح نافذة منبثقة تعرض الصورة بحجم كامل
- يمكن إغلاق النافذة بالضغط في أي مكان خارج الصورة أو بزر Escape

### 3. أنواع المرفقات المدعومة
- صورة شخصية لليتيم
- شهادة الوفاة
- صورة هوية الشهيد
- صورة هوية الزوجة
- شهادة ميلاد
- حجة الوصاية
- صورة هوية الوصي

### 4. رفع المرفقات
- عند إرسال النموذج العام، يتم رفع جميع المرفقات المرفقة تلقائياً
- يتم عرض رسالة نجاح بعد رفع جميع المرفقات

## التحديثات التقنية

### Frontend
1. **صفحة الأيتام** (`frontend/app/(dashboard)/orphans/page.tsx`):
   - إضافة interface للمرفقات
   - إضافة دالة `getAttachmentTypeText` لترجمة أسماء المرفقات إلى العربية
   - إضافة دالة `openImageModal` لفتح الصور بحجم كامل
   - إضافة قسم المرفقات في Modal التفاصيل
   - إضافة Modal منفصل لعرض الصور بحجم كامل

2. **صفحة النموذج العام** (`frontend/app/form/[id]/page.tsx`):
   - تحديث دالة `submitForm` لرفع المرفقات بعد إرسال البيانات
   - إضافة معالجة أخطاء أفضل لرفع المرفقات

### Backend
1. **Serializers** (`backend/api/serializers.py`):
   - تحديث `AttachmentSerializer` ليعيد URL كامل للملف باستخدام `SerializerMethodField`
   - هذا يضمن أن الصور يمكن الوصول إليها من Frontend

2. **Settings** (`backend/orphan_management/settings.py`):
   - تأكيد إعدادات MEDIA_URL و MEDIA_ROOT صحيحة
   - دعم التخزين المحلي و R2/S3 Storage

3. **URLs** (`backend/orphan_management/urls.py`):
   - التأكد من خدمة الملفات الوسائطية في بيئة التطوير

## كيفية الاستخدام

### 1. رفع مرفقات جديدة
1. افتح النموذج العام من خلال الرابط المُنشأ
2. املأ جميع الحقول المطلوبة
3. في خطوة المرفقات (الخطوة 7)، قم برفع الملفات المطلوبة
4. اضغط "إرسال الطلب" في النهاية
5. سيتم رفع جميع المرفقات تلقائياً

### 2. عرض المرفقات
1. سجل الدخول إلى لوحة التحكم
2. انتقل إلى صفحة "بيانات الأيتام والأوصياء"
3. اختر يتيماً من القائمة واضغط "عرض التفاصيل"
4. ستظهر المرفقات في قسم "المرفقات والصور"
5. اضغط على أي صورة لعرضها بحجم كامل

## المتطلبات
- Backend يعمل على المنفذ 8000
- Frontend يعمل على المنفذ 3000
- Django يخدم الملفات الوسائطية بشكل صحيح
- المتصفح يدعم JavaScript وAPI الحديثة

## ملاحظات
- الصور يتم عرضها مباشرة في الصفحة
- الملفات الأخرى (PDF، DOC، إلخ) تحتاج إلى فتحها في نافذة جديدة
- يمكن رفع صور بأي صيغة (JPG, PNG, GIF, WebP)
- يتم حفظ جميع المرفقات في مجلد `backend/media/attachments/`

## استكشاف الأخطاء

### المرفقات لا تظهر
1. تأكد من أن Backend يعمل بشكل صحيح
2. تحقق من أن المرفقات تم رفعها بنجاح (انظر إلى مجلد media)
3. تحقق من console المتصفح للأخطاء

### الصور لا تُحمل
1. تأكد من إعدادات CORS في Backend
2. تحقق من أن URL الصور صحيح (يجب أن يبدأ بـ http://localhost:8000/media/)
3. تحقق من permissions على مجلد media

### لا يمكن رفع المرفقات
1. تأكد من أن endpoint `/api/attachments/upload/` يعمل
2. تحقق من أن حجم الملف مناسب
3. تحقق من صيغة الملف المدعومة

